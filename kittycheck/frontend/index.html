<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KittyCheck</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">
  <div class="bg-white shadow-2xl rounded-2xl p-6 w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">ğŸ¾ KittyCheck</h1>

    <form id="form-control" class="space-y-4">
      <div>
        <label class="block mb-1 font-medium">Nombre del gato</label>
        <input id="nombre" type="text" required class="w-full border rounded p-2" placeholder="Ej: Michi">
      </div>
      <div>
        <label class="block mb-1 font-medium">Peso (gramos)</label>
        <input id="peso" type="number" required class="w-full border rounded p-2" placeholder="Ej: 4000">
      </div>
      <div>
        <label class="block mb-1 font-medium">Desparasitante</label>
        <select id="desparasitante" class="w-full border rounded p-2">
          <option>Ivermectina 1%</option>
          <option>Fenbendazol</option>
          <option>Pyrantel</option>
          <option>Praziquantel</option>
          <option>Milbemicina</option>
        </select>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700">Calcular dosis</button>
    </form>

    <div id="historial" class="mt-6">
      <h2 class="text-lg font-semibold mb-2">ğŸ“‹ Historial de notificaciones</h2>
      <ul id="notificaciones" class="space-y-2"></ul>
      <button onclick="limpiarHistorial()" class="mt-2 bg-red-500 text-white px-3 py-1 rounded">Limpiar historial</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('form-control');
    const lista = document.getElementById('notificaciones');

    // Cargar historial guardado
    let historial = JSON.parse(localStorage.getItem('historial')) || [];
    renderHistorial();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const nombre = document.getElementById('nombre').value;
      const peso = document.getElementById('peso').value;
      const desparasitante = document.getElementById('desparasitante').value;

      const res = await fetch('/api/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ peso_gramos: parseFloat(peso), desparasitante })
      });

      const data = await res.json();
      if(data.error){
        alert(data.error);
        return;
      }

      const mensaje = `Dosis recomendada para ${nombre}: ${data.dosis_recomendada} de ${data.desparasitante} (peso: ${data.peso_gato})`;
      historial.push(mensaje);
      localStorage.setItem('historial', JSON.stringify(historial));
      renderHistorial();
      alert(mensaje);
    });

    function renderHistorial(){
      lista.innerHTML = '';
      historial.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        li.className = 'bg-gray-200 p-2 rounded';
        lista.appendChild(li);
      });
    }

    function limpiarHistorial(){
      historial = [];
      localStorage.removeItem('historial');
      renderHistorial();
    }
  </script>
</body>
</html>
